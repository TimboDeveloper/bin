#!/bin/sh

rgb() {
    while getopts ":hb" opt; do
        case $opt in
        h)
            return 0
        ;;
        b)
            MODE="\x1b[1m"
            break
        ;;
        \?)
            echo "Invalid option: -$OPTARG"
            break    
        ;;
        esac
    done

    if [ "$(echo $#)" -gt 4 ]; then
        shift $((OPTIND-1))
    fi

    local msg=${1}
    local R=${2}
    local G=${3}
    local B=${4}

    if [ -z "$msg" ]; then
        rgb "it is necessary to pass a message as an argument" $RED 
        exit 1
    fi
    
    if [ -z $R ] || [ -z $G ] || [ -z $B ]; then
        echo "$msg"
        return 0
    fi

    local open="$MODE\x1b[38;2;$R;$G;$B""m"
    local close="\x1b[0m"

    if [[ "$msg" =~ $'\x1b[0m' ]]; then
        echo -e $(echo "$open$msg" | sed -r "s/\\x1b\[0m/$open/g")"$close"
    else
        echo -e "$open$msg$close"
    fi
}
