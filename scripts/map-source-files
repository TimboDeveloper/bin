#!/bin/sh
PACKAGES_DIR="packages"
SOURCE_MAP_TARGET="sourceMap.txt"

generateSourceMap() {
    sourceFiles=$(find $PACKAGES_DIR -type f)
    lastPackageName=""

    echo "# THIS FILE IS AUTOMATICALLY GENERATED BY 'scripts/map-source-files'"
    echo "#"
    echo "# This file maps the source code of all packages to the 'binara' CLI to enable installation of the packages from https://raw.githubusercontent.com/"
    echo

    for file in $sourceFiles; do
        packageName=$(dirname $file)

        if [[ $lastPackageName != $packageName ]]; then
            if ! [ -z $lastPackageName ]; then
                echo "</$lastPackageName>"
                echo
            fi
            echo "<$packageName>"
            lastPackageName=$packageName
        fi
        
        echo "$file"
    done

    echo "</$lastPackageName>"
}

rm -rf "./$SOURCE_MAP_TARGET"
generateSourceMap >> $SOURCE_MAP_TARGET
